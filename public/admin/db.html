<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PriceCheck Admin - DB</title>
  <meta name="robots" content="noindex,nofollow" />
  <link rel="stylesheet" href="admin.css" />
  <link rel="icon" type="image/svg+xml" href="/logo/logo.svg">

  <style>
    /* DB manager layout: left catalog, right offers. Horizontal scroll is expected. */
    .dbWrap { padding: 18px; }
    .dbTop {
      display:flex;
      align-items:flex-end;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 14px;
    }
    /* Prevent browser back/forward swipe from stealing horizontal scroll gestures */
    .dbScroll {
    overscroll-behavior-x: contain;
    touch-action: pan-x pan-y;
    -ms-touch-action: pan-x pan-y;
    }
    #mount {
    touch-action: pan-x pan-y;
    -ms-touch-action: pan-x pan-y;
    }
    .dbTop .grow { flex: 1; min-width: 260px; }
    .dbTop input {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid var(--line, #eaecef);
      border-radius: 14px;
      background: var(--paper, #fff);
      color: var(--ink, #111);
      outline: none;
    }
    .dbMeta { font-size: 13px; color: var(--muted, #6b7280); }

    .dbGridOuter {
      border: 1px solid var(--line, #eaecef);
      border-radius: 18px;
      overflow: hidden;
      background: var(--paper, #fff);
    }

    .dbHeader {
      display:flex;
      gap: 12px;
      padding: 12px 12px;
      border-bottom: 1px solid var(--line, #eaecef);
      background: rgba(0,0,0,0.02);
      align-items:center;
    }

    .dbScroll{
        overflow-x: auto;
        overflow-y: visible;   /* let the page (body) handle up/down */
        max-height: none;      /* remove the vertical clamp */
        height: auto;          /* do not force an inner scroll area */
    }

    /* one item row */
    .itemRow {
      display: grid;
      grid-template-columns: 420px 1fr;
      border-bottom: 1px solid var(--line, #eaecef);
      min-width: 980px; /* force horizontal scroll on smaller screens */
    }
    .itemRow:last-child { border-bottom: none; }

    /* Left catalog column */
    .catCol {
      border-right: 1px solid var(--line, #eaecef);
      padding: 12px;
      position: sticky;
      left: 0;
      background: var(--paper, #fff);
      z-index: 2;
    }

    .catTitle {
      font-weight: 700;
      font-size: 14px;
      margin-bottom: 6px;
    }
    .small { font-size: 12px; color: var(--muted, #6b7280); }

    .formGrid {
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 10px;
    }
    .fg {
      display:flex;
      flex-direction: column;
      gap: 6px;
    }
    .fg label {
      font-size: 12px;
      color: var(--muted, #6b7280);
    }
    .fg input {
      padding: 10px 12px;
      border: 1px solid var(--line, #eaecef);
      border-radius: 12px;
      background: var(--paper, #fff);
      color: var(--ink, #111);
      outline: none;
    }
    .fg.full { grid-column: 1 / -1; }

    .rowActions {
      display:flex;
      align-items:center;
      gap: 10px;
      margin-top: 10px;
    }
    .btn {
      border: 1px solid var(--line, #eaecef);
      background: #fff;
      padding: 10px 12px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
    }
    .btnPrimary {
      background: #111;
      color: #fff;
      border-color: #111;
    }
    .saveMsg { font-size: 12px; color: var(--muted, #6b7280); }

    /* Right offers column */
    .offersCol {
      padding: 12px;
      background: var(--paper, #fff);
    }

    .storesRow {
      display:flex;
      gap: 12px;
      align-items: flex-start;
    }

    .storeCol {
      min-width: 320px;
      max-width: 420px;
      border: 1px solid var(--line, #eaecef);
      border-radius: 16px;
      padding: 10px;
      background: rgba(0,0,0,0.01);
    }
    .storeHead {
      display:flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      gap: 8px;
    }
    .storeName { font-weight: 800; font-size: 13px; }
    .storeCount { font-size: 12px; color: var(--muted, #6b7280); }

    .offerCard {
      border: 1px solid var(--line, #eaecef);
      border-radius: 14px;
      padding: 10px;
      background: #fff;
      margin-bottom: 10px;
    }
    .offerCard:last-child { margin-bottom: 0; }

    .offerTop {
      display:flex;
      justify-content: space-between;
      gap: 10px;
      align-items: flex-start;
      margin-bottom: 8px;
    }
    .offerSku { font-weight: 700; font-size: 12px; }
    .offerSeen { font-size: 12px; color: var(--muted, #6b7280); text-align: right; }

    .offerGrid {
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    .offerGrid .fg.full { grid-column: 1 / -1; }

    .offerLinks {
      display:flex;
      gap: 8px;
      align-items: center;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .chip {
      display:inline-flex;
      align-items:center;
      gap: 6px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--line, #eaecef);
      background: #fff;
      font-weight: 700;
      font-size: 12px;
      cursor: pointer;
      text-decoration: none;
      color: inherit;
    }
  </style>
</head>

<body>
  <div class="page">
    <div id="site-header"></div>

    <main class="dbWrap">
      <div class="dbTop">
        <a href="index.html" aria-label="Home">
          <img src="/logo/logo.svg" alt="PriceCheck" width="36" height="36">
        </a>

        <div class="grow">
          <input id="q" placeholder="Search..." autocomplete="off" />
        </div>
        <button class="btn btnPrimary" id="btnRun" type="button">Run</button>
        <div class="dbMeta" id="status">Ready.</div>
      </div>

      <div class="dbGridOuter">
        <div class="dbHeader">
          <div style="font-weight:600">Database Manager</div>
        </div>

        <div class="dbScroll">
          <div id="mount" style="min-width:980px"></div>
        </div>
      </div>
    </main>
  </div>
  <script src="/admin/db.js" defer></script>
  <script>
  // Capture horizontal wheel/trackpad swipes inside the DB scroll area
  // so they scroll the panel instead of triggering browser navigation.
  (function () {
    const scroller = document.querySelector(".dbScroll");
    if (!scroller) return;

    // Prefer horizontal scroll when a trackpad sends wheel deltas.
    scroller.addEventListener(
      "wheel",
      (e) => {
        const absX = Math.abs(e.deltaX);
        const absY = Math.abs(e.deltaY);

        // If there's meaningful horizontal intent, consume it and scroll.
        if (absX > 0 || (absY > 0 && e.shiftKey)) {
          const dx = e.deltaX || (e.shiftKey ? e.deltaY : 0);
          if (dx) {
            scroller.scrollLeft += dx;
            e.preventDefault();
          }
        }
      },
      { passive: false }
    );

    // On touch devices, keep horizontal swipe inside the scroller.
    let startX = 0, startY = 0;
    scroller.addEventListener("touchstart", (e) => {
      if (e.touches && e.touches[0]) {
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
      }
    }, { passive: true });

    scroller.addEventListener("touchmove", (e) => {
      if (!e.touches || !e.touches[0]) return;
      const dx = e.touches[0].clientX - startX;
      const dy = e.touches[0].clientY - startY;

      // If the gesture is mostly horizontal, prevent it from becoming history nav.
      if (Math.abs(dx) > Math.abs(dy)) e.preventDefault();
    }, { passive: false });
  })();
</script>

</body>
</html>
